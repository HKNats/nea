{% extends 'base.html'%}

{%block scripts%}
<script  type='text/javascript'>

$(document).ready(async()=>{
    
 const {labels,datasets}=await getSourceData();
  const DATA_COUNT = 5;
const NUMBER_CFG = {count: DATA_COUNT, min: 0, max: 100};
 const config = {
    type: 'doughnut',
    data: {
  labels: labels,
  datasets: datasets
},
    options: {
      responsive: true,
    }
  };
  console.log(labels,datasets);
  var ctx = document.getElementById('myChart').getContext('2d');
  var myChart=new Chart(ctx, config);
  
  $("#line").click(function() {
    change('line');
  });
  
  $("#bar").click(function() {
    change('bar');
  });
  $("#pie").click(function() {
    change('pie');
  });
  $("#doughnut").click(function() {
    change('doughnut');
  });
  function change(newType) {
    var ctx = document.getElementById('myChart').getContext('2d');
  
    // Remove the old chart and all its event handles
    if (myChart) {
      myChart.destroy();
    }
  
    // Chart.js modifies the object you pass in. Pass a copy of the object so we can use the original object later
    var temp = jQuery.extend(true, {}, config);
    temp.type = newType;
    myChart = new Chart(ctx, temp);
  };


async function getSourceData(){
  const res= await fetch('https://jsonplaceholder.typicode.com/todos/');
  const resJson=await res.json();
  const tempObj={};
  resJson.forEach(item=>{if(!tempObj[item.userId]){tempObj[item.userId]=0;}tempObj[item.userId]++});
  const labels=Object.keys(tempObj);
  const data=Object.values(tempObj);
  const backgroundColor=[];
  const borderColor=[];
  for(let i=0;i<labels.length;i++){
    backgroundColor.push(getRandomColor());
    borderColor.push(getRandomColor());
  }
  const datasets= [{data: data,backgroundColor, fill: false,}]
  return {labels,datasets};
}
function getRandomColor() {
    let letters = '0123456789ABCDEF'.split('');
    let color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

});
</script>
{%endblock scripts%}

{%block content%}
<label for="SelectChartType">SelectChartType</label>
<button id='line'>line</button>
<button id='bar'>bar</button>
<button id='pie'>pie</button>
<button id='doughnut'>doughnut</button>
<label for="selectDuration">selectDuration</label>
<input type="date" id="startDuration" name="startDuration">
<input type="date" id="startDuration" name="startDuration">
<button id='getNewData'>Submit</button>
<!-- displaying the chart -->
<!-- you can also play around with the width and height to increase or decrease the chart size -->
<canvas id="myChart" width="200" height="100"></canvas>  
{%endblock content%}